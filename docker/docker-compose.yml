version: '3.8'

services:
  carla-system:
    build:
      context: ..
      dockerfile: docker/Dockerfile
    
    image: intelligent-traffic-light-teamb:latest
    
    container_name: carla_vision_system
    
    ports:
      - "2000:2000"  # CARLA RPC
      - "2001:2001"  # CARLA Streaming
      - "8000:8000"  # FastAPI
      - "5900:5900"  # VNC
      - "6080:6080"  # noVNC
    
    environment:
      - DISPLAY=:99
      - NVIDIA_VISIBLE_DEVICES=all
      - NVIDIA_DRIVER_CAPABILITIES=all
    
    volumes:
      - ../:/workspace
      - carla_data:/home/carla
    
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    
    runtime: nvidia
    
    stdin_open: true
    tty: true
    
    command: ["all"]

volumes:
  carla_data:
